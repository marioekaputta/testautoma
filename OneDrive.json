{"createdAt":"2022-07-04T14:08:06.122Z","updatedAt":"2022-07-04T14:08:55.543Z","deletedAt":null,"id":156,"name":"OneDrive","logoUrl":"https://storage.googleapis.com/otomatis/appicons/15/1656943731524-download.png","description":null,"homepageUrl":null,"requestUrl":null,"errorReporterEmail":null,"hasAction":true,"hasTrigger":true,"isPremiumApp":false,"createdById":15,"publishedAt":null,"submittedAt":null,"public":false,"teamId":null,"isNativeApp":false,"timeOut":30000,"triggers":[{"createdAt":"2022-03-31T03:26:57.918Z","updatedAt":"2022-07-06T18:17:01.577Z","deletedAt":null,"id":737,"name":"New Files in Folder","type":"polling","applicationId":156,"httpRequestId":1885,"dummyTriggerHttpRequestId":null,"subscribeHttpRequestId":null,"unsubscribeHttpRequestId":null,"findLastStateFunc":null,"stateKeyMap":"({data}) => data.value","paramSchema":[{"key":"path","type":"string","label":"Item Path","helpText":"You must specified your folder path (if not used the root). Specified path format: `root:/{path}:`. Example `root:/Documents/InsideDocuments/InsideAgain:`\n\nIf you want to use the root folder, just write `root`","required":true,"isDropdown":false}],"authenticationId":164,"description":"trigger to get all files","condition":null,"isAsc":false,"versionId":172,"examplePayload":null,"visibility":"visible","webhookResponseFunc":null,"testGuideline":null,"similarityThreshold":null,"isAggregator":null,"isGlobalAggregator":null,"isDraft":false,"isUsingPagination":null,"cron":null,"idempotencyKeyMap":"{{{[data].[id]}}}","httpRequest":{"createdAt":"2022-03-31T03:28:13.243Z","updatedAt":"2022-07-06T18:17:01.423Z","deletedAt":null,"id":1885,"url":"https://graph.microsoft.com/v1.0/me/drive/{{{[params].[path]}}}/children","method":"get","headers":{"Authorization":"Bearer {{{[bundle].[access_token]}}}"},"body":null,"getBodyFunc":null,"auth":{}},"dummyTriggerHttpRequest":null,"subscribeHttpRequest":null,"unsubscribeHttpRequest":null},{"createdAt":"2022-07-04T14:17:19.776Z","updatedAt":"2022-07-04T15:28:25.780Z","deletedAt":null,"id":745,"name":"New Folder","type":"polling","applicationId":156,"httpRequestId":1899,"dummyTriggerHttpRequestId":null,"subscribeHttpRequestId":null,"unsubscribeHttpRequestId":null,"findLastStateFunc":null,"stateKeyMap":"({data}) => data.value.filter((file) => file.folder)","paramSchema":[{"key":"path","type":"string","label":"Item Path","helpText":"You must specified your folder path (if not used the root). Specified path format: `root:/{path}:`. Example `root:/Documents/InsideDocuments/InsideAgain:`\n\nIf you want to use the root folder, just write `root`","required":true,"isDropdown":false}],"authenticationId":164,"description":"trigger when new folder","condition":null,"isAsc":false,"versionId":172,"examplePayload":null,"visibility":"visible","webhookResponseFunc":null,"testGuideline":null,"similarityThreshold":null,"isAggregator":null,"isGlobalAggregator":null,"isDraft":false,"isUsingPagination":null,"cron":null,"idempotencyKeyMap":"{{{[data].[id]}}}","httpRequest":{"createdAt":"2022-03-31T03:28:13.243Z","updatedAt":"2022-07-04T15:28:25.728Z","deletedAt":null,"id":1899,"url":"https://graph.microsoft.com/v1.0/me/drive/{{{[params].[path]}}}/children","method":"get","headers":{"Authorization":"Bearer {{{[bundle].[access_token]}}}"},"body":null,"getBodyFunc":null,"auth":{}},"dummyTriggerHttpRequest":null,"subscribeHttpRequest":null,"unsubscribeHttpRequest":null}],"actions":[{"createdAt":"2022-07-06T19:00:21.771Z","updatedAt":"2022-07-06T19:09:44.136Z","deletedAt":null,"id":962,"name":"Upload File","type":"script","category":"write","applicationId":156,"httpRequestId":null,"paramSchema":[{"key":"url","type":"string","label":"File URL","helpText":"The URL of file you want to upload","required":true},{"key":"name","type":"string","label":"File Name","helpText":"What you want your file to be named","required":true},{"key":"path","type":"string","label":"Item Path","helpText":"You must specified your folder path (if not used the root). Specified path format: `root:/{path}:`. Example `root:/Documents/InsideDocuments/InsideAgain:`\n\nIf you want to use the root folder, just write `root`","required":true,"isDropdown":false}],"authenticationId":164,"description":"upload a file by url","versionId":172,"examplePayload":null,"stateKeyMap":"async ({ params, bundle }) => {\n  function ArrayBufferToBinary(buffer) {\n    // Convert an array buffer to a string bit-representation: 0 1 1 0 0 0...\n    var dataView = new DataView(buffer);\n    var response = \"\", offset = (8/8); \n    for(var i = 0; i < dataView.byteLength; i += offset) {\n        response += dataView.getInt8(i).toString(2); \n    }\n    return response;\n  }\n\n  try {\n    const FormData = require('form-data')\n    const fs = require('fs')\n    const axios = module.require('axios')\n    \n    const downloadFile = (imageURL) =>\n      axios({\n        url: imageURL,\n        responseType: 'stream',\n      }).then(\n        response =>\n          new Promise((resolve, reject) => {\n            const extension = response.headers['content-type'].split('/')[1]\n            const filePath = `/tmp/${Date.now()}.${extension}`\n              response.data\n                // filename must be specific to user and unique, extention must be match the real image\n                .pipe(fs.createWriteStream(filePath))\n                .on('finish', () => resolve(filePath))\n                .on('error', e => reject(e))\n          })\n      )\n    \n    const formObj = await downloadFile(params.url)\n      .then((filePath) => {\n        const form = new FormData()\n        const payload = fs.createReadStream(filePath)\n        form.append('file', payload)\n        return form\n      })\n      .catch(err => {\n        console.log(\"ERROR 1\", error)\n        throw new Error(\"Something went wrong: \", err)\n      })\n\n    const resp = await axios.put(`https://graph.microsoft.com/v1.0/me/drive/{{{[params].[path]}}}/{{{[params].[name]}}}/content`, ArrayBufferToBinary(formObj), {\n      headers: {\n            Authorization: `Bearer ${bundle.access_token}`,\n            ...formObj.getHeaders()\n        }\n    })\n    return resp\n  } catch (error) {\n    console.log(\"ERROR 2\", error)\n    throw Error(\"Something went wrong\")\n  }\n}","isDraft":true,"idempotencyKeyMap":null,"httpRequest":null},{"createdAt":"2022-07-04T15:30:42.868Z","updatedAt":"2022-07-04T16:13:17.679Z","deletedAt":null,"id":959,"name":"Find Folders by Folders' Name","type":"http","category":"search","applicationId":156,"httpRequestId":1900,"paramSchema":[{"key":"value","type":"string","label":"Value","helpText":"Type the keyword that included on your folders' name. Results will show all the folders contains the value of this field","required":true,"isDropdown":false}],"authenticationId":164,"description":"find folders by folders' name","versionId":172,"examplePayload":null,"stateKeyMap":"({data}) => data.value.filter(file => file.folder)","isDraft":false,"idempotencyKeyMap":null,"httpRequest":{"createdAt":"2022-04-01T07:07:12.504Z","updatedAt":"2022-04-01T07:07:28.318Z","deletedAt":null,"id":1900,"url":"https://graph.microsoft.com/v1.0/me/drive/search(q='{{{[params].[value]}}}')","method":"get","headers":{"Authorization":"Bearer {{{[bundle].[access_token]}}}"},"body":null,"getBodyFunc":null,"auth":{}}},{"createdAt":"2022-04-04T05:58:56.185Z","updatedAt":"2022-07-04T16:12:17.856Z","deletedAt":null,"id":954,"name":"Find Files by Files' Name","type":"http","category":"search","applicationId":156,"httpRequestId":1894,"paramSchema":[{"key":"path","type":"string","label":"Item Path","helpText":"You must specified your folder path (if not used the root). Specified path format: `root:/{path}:`. Example `root:/Documents/InsideDocuments/InsideAgain:`\n\nIf you want to use the root folder, just write `root`","required":true,"isDropdown":false},{"key":"value","type":"string","label":"Value","helpText":"Type the keyword that included on your files' name. Results will show all the files contains the value of this field","required":true,"isDropdown":false}],"authenticationId":164,"description":"find files by files' name","versionId":172,"examplePayload":null,"stateKeyMap":"({data}) => data.value","isDraft":false,"idempotencyKeyMap":null,"httpRequest":{"createdAt":"2022-04-01T07:07:12.504Z","updatedAt":"2022-04-01T07:07:28.318Z","deletedAt":null,"id":1894,"url":"https://graph.microsoft.com/v1.0/me/drive/search(q='{{{[params].[value]}}}')","method":"get","headers":{"Authorization":"Bearer {{{[bundle].[access_token]}}}"},"body":null,"getBodyFunc":null,"auth":{}}}],"globalVariables":[],"versions":[{"createdAt":"2022-03-31T03:17:36.847Z","updatedAt":"2022-03-31T03:17:36.847Z","deletedAt":null,"id":172,"name":"1.0.0","applicationId":156,"isActive":true}],"authentications":[{"createdAt":"2022-03-31T08:23:50.985Z","updatedAt":"2022-03-31T08:23:50.985Z","deletedAt":null,"id":164,"uuid":"198ecda6-326d-4928-ab2e-6ff99d5e980c","authenticationSchemaId":2,"fieldSchema":null,"testHttpRequestId":1878,"clientId":"d816367a-149c-4ff8-b586-5e3cf4fbdd61","clientSecret":"ubH8Q~SrxB-PPqL3VenGiWGdoX4WNrwo-L1nwb20","getUserFunc":null,"authHttpRequestId":1879,"reqTokenHttpRequestId":1880,"refreshTokenHttpRequestId":1881,"applicationId":156,"versionId":172,"examplePayload":null,"isDraft":false,"helpText":null,"testHttpRequest":{"createdAt":"2022-03-31T08:56:32.055Z","updatedAt":"2022-07-12T02:24:24.763Z","deletedAt":null,"id":1878,"url":"https://graph.microsoft.com/v1.0/me/","method":"get","headers":{"Accept":"application/json","Content-Type":"application/json","Authorization":"Bearer {{{bundle.access_token}}}"},"body":null,"getBodyFunc":null,"auth":{}},"authHttpRequest":{"createdAt":"2022-03-31T08:56:31.885Z","updatedAt":"2022-07-12T02:24:24.459Z","deletedAt":null,"id":1879,"url":"https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id={{{bundle.clientId}}}&redirect_uri={{{bundle.redirectUrl}}}&scope=user.read%20files.readwrite.all%20offline_access&response_type=code","method":"get","headers":{},"body":null,"getBodyFunc":null,"auth":{}},"reqTokenHttpRequest":{"createdAt":"2022-03-31T08:56:31.984Z","updatedAt":"2022-07-12T02:24:24.660Z","deletedAt":null,"id":1880,"url":"https://login.microsoftonline.com/common/oauth2/v2.0/token","method":"post","headers":{"Content-Type":"application/x-www-form-urlencoded"},"body":{"code":"{{bundle.code}}","client_id":"{{bundle.clientId}}","grant_type":"authorization_code","redirect_uri":"{{bundle.redirectUrl}}","client_secret":"{{bundle.clientSecret}}"},"getBodyFunc":null,"auth":{}},"refreshTokenHttpRequest":{"createdAt":"2022-04-01T04:27:42.999Z","updatedAt":"2022-07-12T02:24:24.570Z","deletedAt":null,"id":1881,"url":"https://login.microsoftonline.com/common/oauth2/v2.0/token","method":"post","headers":{"Content-Type":"application/x-www-form-urlencoded"},"body":{"client_id":"{{{bundle.clientId}}}","grant_type":"refresh_token","redirect_uri":"{{bundle.redirectUrl}}","client_secret":"{{{bundle.clientSecret}}}","refresh_token":"{{{bundle.refresh_token}}}"},"getBodyFunc":null,"auth":{}}}]}